<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ê²½ì œìš© AI ê²€ìƒ‰</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      body {
        font-family: "Noto Sans KR", sans-serif;
      }
      .citation-link {
        color: #3b82f6;
        text-decoration: none;
        font-size: 0.75rem;
        vertical-align: super;
        margin: 0 2px;
        cursor: pointer;
      }
      .citation-link:hover {
        text-decoration: underline;
      }
      .search-suggestion {
        transition: all 0.2s;
      }
      .search-suggestion:hover {
        background-color: #f3f4f6;
        transform: translateX(4px);
      }
      .answer-container {
        line-height: 1.8;
      }
      .answer-container h2,
      .answer-container h3 {
        margin-top: 1.5rem;
        margin-bottom: 0.75rem;
        font-weight: bold;
      }
      .answer-container p {
        margin-bottom: 1rem;
      }
    </style>
  </head>
  <body
    class="flex flex-col min-h-screen items-center p-4 selection:bg-orange-200 selection:text-orange-800"
  >
    <header class="w-full max-w-5xl text-center py-8">
      <div class="flex justify-center items-center space-x-4">
        <h1 class="text-4xl font-bold text-orange-500">ê²½ì œìš©</h1>
        <a
          href="https://www.instagram.com/economy_dragon_/"
          target="_blank"
          class="text-orange-500 hover:text-orange-600 transition-colors"
        >
          <i class="fab fa-instagram text-3xl"></i>
        </a>
      </div>
      <p class="mt-2 text-gray-600">
        ê²½ì œ ìš©ì–´ì™€ ìµœì‹  ê²½ì œ ì½˜í…ì¸ ë¥¼ ì‰½ê²Œ ì•Œì•„ë³´ì„¸ìš”! ğŸ²
      </p>
    </header>

    <div class="w-full max-w-5xl mb-6 px-4 sm:px-0">
      <div class="relative">
        <input
          type="text"
          id="global-search"
          placeholder="ê²½ì œ ìš©ì–´ ë˜ëŠ” ì½˜í…ì¸  ê²€ìƒ‰..."
          class="w-full pl-10 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent outline-none"
        />
        <svg
          class="absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
          />
        </svg>
      </div>
    </div>

    <div class="w-full max-w-5xl mb-6">
      <div
        class="flex justify-center space-x-4 sm:space-x-8 border-b border-gray-200 pb-2"
      >
        <button
          id="tab-chatbot"
          class="tab-button text-md sm:text-lg py-2 px-3 sm:px-4 active"
        >
          AI ê²€ìƒ‰
        </button>
        <button
          id="tab-terms"
          class="tab-button text-md sm:text-lg py-2 px-3 sm:px-4"
        >
          ê²½ì œ ìš©ì–´
        </button>
        <button
          id="tab-contents"
          class="tab-button text-md sm:text-lg py-2 px-3 sm:px-4"
        >
          ìµœì‹  ì½˜í…ì¸ 
        </button>
      </div>
    </div>

    <main
      id="chatbot-section"
      class="w-full max-w-3xl flex-grow flex flex-col bg-white shadow-2xl rounded-xl p-6 space-y-6 border border-gray-200"
    >
      <div
        class="flex items-center justify-center space-x-4 p-4 bg-orange-50 rounded-lg"
      >
        <img
          src="https://img2.stibee.com/d2fad6b1-3012-4b5c-943a-3ca4c6a1b546.png"
          alt="[ê·€ì—¬ìš´ ê²½ì œìš© ìºë¦­í„°]"
          class="dragon-character-image"
        />
        <div>
          <p class="text-xl font-semibold text-orange-700">
            ì•ˆë…•! ë‚˜ëŠ” ê²½ì œìš©ì´ì•¼.
          </p>
          <p class="text-md text-orange-600">
            ì–´ë ¤ìš´ ê²½ì œ, ë‚´ê°€ ì‰½ê³  ì¬ë¯¸ìˆê²Œ ì•Œë ¤ì¤„ê²Œ! ë­ë“ ì§€ ë¬¼ì–´ë´ìš©~
          </p>
        </div>
      </div>

      <!-- ì¶”ì²œ ê²€ìƒ‰ì–´ -->
      <div id="suggested-searches" class="mb-4">
        <h3 class="text-lg font-medium mb-4">ì¶”ì²œ AI ê²€ìƒ‰ì–´</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div
            class="search-suggestion bg-white p-4 rounded-lg cursor-pointer border hover:border-orange-200"
          >
            <p class="text-gray-800">ETFë€ ë¬´ì—‡ì¸ê°€ìš”?</p>
          </div>
          <div
            class="search-suggestion bg-white p-4 rounded-lg cursor-pointer border hover:border-orange-200"
          >
            <p class="text-gray-800">ê¸ˆë¦¬ì¸ìƒì´ ì£¼ì‹ì‹œì¥ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì€?</p>
          </div>
          <div
            class="search-suggestion bg-white p-4 rounded-lg cursor-pointer border hover:border-orange-200"
          >
            <p class="text-gray-800">ì¸í”Œë ˆì´ì…˜ í—¤ì§€ ë°©ë²•ì€ ë¬´ì—‡ì¸ê°€ìš”?</p>
          </div>
          <div
            class="search-suggestion bg-white p-4 rounded-lg cursor-pointer border hover:border-orange-200"
          >
            <p class="text-gray-800">ìš”ì¦˜ ì£¼ëª©ë°›ëŠ” ê²½ì œ ì´ìŠˆëŠ” ë¬´ì—‡ì¸ê°€ìš”?</p>
          </div>
        </div>
      </div>

      <!-- ëŒ€í™” ì¶œë ¥ ì˜ì—­ -->
      <div
        id="chat-output"
        class="flex-grow h-96 overflow-y-auto p-4 space-y-2 border border-gray-200 rounded-lg bg-gray-50"
      >
        <div class="chat-bubble bot-bubble">
          <span class="font-semibold">ê²½ì œìš©:</span> ë¬´ì—‡ì´ ê¶ê¸ˆí•œê°€ìš©? ê²½ì œ
          ê´€ë ¨ ì§ˆë¬¸ì„ í•´ë³´ì„¸ìš©!
        </div>
      </div>

      <!-- ê²€ìƒ‰ ê²°ê³¼ ì˜ì—­ -->
      <div id="search-results" class="hidden">
        <!-- ë¡œë”© ìƒíƒœ -->
        <div id="loading-state" class="hidden">
          <div class="bg-white rounded-lg shadow-sm p-6">
            <div class="flex items-center gap-3">
              <div
                class="animate-spin rounded-full h-8 w-8 border-4 border-orange-500 border-t-transparent"
              ></div>
              <p class="text-gray-600">ë‹µë³€ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
            </div>
          </div>
        </div>

        <!-- ë‹µë³€ ì˜ì—­ -->
        <div id="answer-area" class="hidden">
          <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
            <div class="flex items-start gap-3 mb-4">
              <div class="p-2 bg-orange-100 rounded-lg">
                <i class="fas fa-sparkles text-orange-600"></i>
              </div>
              <h3 class="text-lg font-medium">AI ìš”ì•½</h3>
            </div>
            <div
              id="answer-content"
              class="answer-container text-gray-800"
            ></div>
          </div>

          <!-- ì¶œì²˜ ì„¹ì…˜ -->
          <div id="sources-area" class="bg-white rounded-lg shadow-sm p-6">
            <h3 class="text-lg font-medium mb-4">ì¶œì²˜</h3>
            <div id="sources-list" class="space-y-3"></div>
          </div>
        </div>
      </div>

      <div class="flex items-center space-x-3 pt-4 border-t border-gray-200">
        <input
          type="text"
          id="chat-input"
          placeholder="ì—¬ê¸°ì— ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..."
          class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent outline-none transition-all duration-150 ease-in-out"
        />
        <button
          id="send-button"
          class="bg-orange-500 hover:bg-orange-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:shadow-lg transition-all duration-150 ease-in-out transform hover:scale-105 active:bg-orange-700"
        >
          ê²€ìƒ‰
        </button>
      </div>
    </main>

    <main
      id="terms-section"
      class="w-full max-w-5xl flex-grow flex-col bg-white shadow-2xl rounded-xl p-6 space-y-6 border border-gray-200 hidden"
    >
      <h2
        class="text-2xl font-bold text-orange-500 mb-6 text-center sm:text-left"
      >
        ê²½ì œ ìš©ì–´ ëª¨ìŒ
        <span id="terms-count" class="text-sm font-normal text-gray-500"
          >(0)</span
        >
      </h2>
      <div class="flex flex-col md:flex-row justify-between gap-4 mb-6">
        <div class="relative flex-grow md:max-w-md">
          <input
            type="text"
            id="terms-search"
            placeholder="ê²½ì œ ìš©ì–´ ê²€ìƒ‰..."
            class="w-full pl-10 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent outline-none"
          />
          <svg
            class="absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
            />
          </svg>
        </div>
        <div class="flex items-center">
          <span class="text-sm text-gray-600 mr-2">ì •ë ¬:</span>
          <select
            id="terms-sort"
            class="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent outline-none"
          >
            <option value="number-asc">ë²ˆí˜¸ ì˜¤ë¦„ì°¨ìˆœ</option>
            <option value="number-desc">ë²ˆí˜¸ ë‚´ë¦¼ì°¨ìˆœ</option>
            <option value="title-asc">ì œëª© ì˜¤ë¦„ì°¨ìˆœ</option>
            <option value="title-desc">ì œëª© ë‚´ë¦¼ì°¨ìˆœ</option>
          </select>
        </div>
      </div>
      <div
        id="terms-grid"
        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
      ></div>
      <div id="terms-no-results" class="text-center py-10 hidden">
        <p class="text-gray-500">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        <button
          id="terms-reset-search"
          class="mt-2 text-orange-500 hover:text-orange-600"
        >
          ê²€ìƒ‰ ì´ˆê¸°í™”
        </button>
      </div>
    </main>

    <main
      id="contents-section"
      class="w-full max-w-5xl flex-grow flex-col bg-white shadow-2xl rounded-xl p-6 space-y-6 border border-gray-200 hidden"
    >
      <h2
        class="text-2xl font-bold text-orange-500 mb-6 text-center sm:text-left"
      >
        ìµœì‹  ê²½ì œ ì½˜í…ì¸ 
        <span id="contents-count" class="text-sm font-normal text-gray-500"
          >(0)</span
        >
      </h2>
      <div class="flex flex-col md:flex-row justify-between gap-4 mb-6">
        <div class="relative flex-grow md:max-w-md">
          <input
            type="text"
            id="contents-search"
            placeholder="ì½˜í…ì¸  ê²€ìƒ‰..."
            class="w-full pl-10 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent outline-none"
          />
          <svg
            class="absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
            />
          </svg>
        </div>
        <div class="flex items-center">
          <span class="text-sm text-gray-600 mr-2">ì •ë ¬:</span>
          <select
            id="contents-sort"
            class="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent outline-none"
          >
            <option value="number-desc">ë²ˆí˜¸ ë‚´ë¦¼ì°¨ìˆœ</option>
            <option value="number-asc">ë²ˆí˜¸ ì˜¤ë¦„ì°¨ìˆœ</option>
            <option value="title-asc">ì œëª© ì˜¤ë¦„ì°¨ìˆœ</option>
            <option value="title-desc">ì œëª© ë‚´ë¦¼ì°¨ìˆœ</option>
          </select>
        </div>
      </div>
      <div
        id="contents-grid"
        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
      ></div>
      <div id="contents-no-results" class="text-center py-10 hidden">
        <p class="text-gray-500">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        <button
          id="contents-reset-search"
          class="mt-2 text-orange-500 hover:text-orange-600"
        >
          ê²€ìƒ‰ ì´ˆê¸°í™”
        </button>
      </div>
    </main>

    <div id="content-modal" class="modal">
      <div class="modal-content">
        <div class="flex justify-between items-center mb-4">
          <h2 id="modal-title" class="text-2xl font-bold text-orange-500"></h2>
          <button
            id="modal-close"
            class="text-gray-500 hover:text-gray-700 p-2 transition-colors duration-200 rounded-full hover:bg-gray-100"
          >
            <svg
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              />
            </svg>
          </button>
        </div>
        <div id="modal-date" class="text-sm text-gray-500 mb-4"></div>
        <div id="modal-content-body" class="markdown-content"></div>
        <div class="mt-6 text-center">
          <button
            id="modal-close-bottom"
            class="px-6 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors duration-200"
          >
            ë‹«ê¸°
          </button>
        </div>
      </div>
    </div>

    <footer class="w-full max-w-5xl text-center py-8 mt-12">
      <h2 class="text-2xl font-semibold text-gray-700 mb-6">
        ë†“ì¹˜ë©´ ì•„ì‰¬ìš´ ê²½ì œìš© ì´ì•¼ê¸° ğŸ²
      </h2>
      <div class="space-y-3">
        <div
          class="footer-list-item p-4 bg-white border border-gray-200 hover:border-orange-200 rounded-lg shadow-sm cursor-pointer text-left"
        >
          <h3 class="font-bold text-orange-600 text-lg">
            ğŸ“ˆ ETF, ì œëŒ€ë¡œ ì•Œê³  íˆ¬ìí•˜ê¸°
          </h3>
          <p class="text-sm text-gray-600 mt-1">
            ë¶„ì‚°íˆ¬ìì˜ ë§ˆë²•ì‚¬ ETF! ê°œë…ë¶€í„° í™œìš© ì „ëµê¹Œì§€ ê²½ì œìš©ì´ ì½•ì½•
            ì•Œë ¤ì¤„ê²Œìš©.
          </p>
        </div>
        <div
          class="footer-list-item p-4 bg-white border border-gray-200 hover:border-orange-200 rounded-lg shadow-sm cursor-pointer text-left"
        >
          <h3 class="font-bold text-orange-600 text-lg">
            ğŸ¦ ê¸ˆë¦¬ ë³€ë™, ë‚´ ì§€ê°‘ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì€?
          </h3>
          <p class="text-sm text-gray-600 mt-1">
            ê¸ˆë¦¬ê°€ ì˜¤ë¥´ë½ë‚´ë¦¬ë½~ ë‚´ ìì‚° ê´€ë¦¬ëŠ” ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œìš©? ê²½ì œìš©ê³¼
            í•¨ê»˜ ì•Œì•„ë´ìš©!
          </p>
        </div>
        <div
          class="footer-list-item p-4 bg-white border border-gray-200 hover:border-orange-200 rounded-lg shadow-sm cursor-pointer text-left"
        >
          <h3 class="font-bold text-orange-600 text-lg">
            ğŸ“Š ì£¼ë¦°ì´ë¥¼ ìœ„í•œ ì²«ê±¸ìŒ, ì£¼ì‹ íˆ¬ì ê°€ì´ë“œ
          </h3>
          <p class="text-sm text-gray-600 mt-1">
            ì£¼ì‹ íˆ¬ìê°€ ì²˜ìŒì´ë¼ë©´? ê²½ì œìš©ì´ ì•Œë ¤ì£¼ëŠ” í•„ìˆ˜ ìš©ì–´ì™€ íˆ¬ì ì›ì¹™!
            ê²ë¨¹ì§€ ë§ê³  ì‹œì‘í•´ìš©!
          </p>
        </div>
      </div>
      <div class="mt-6 flex justify-center items-center">
        <a
          href="https://www.instagram.com/economy_dragon_/"
          target="_blank"
          class="flex items-center text-orange-500 hover:text-orange-600 transition-colors"
        >
          <i class="fab fa-instagram text-xl mr-2"></i>
          <span>@economy_dragon_</span>
        </a>
      </div>
    </footer>

    <!-- JavaScript íŒŒì¼ ë¡œë“œ -->
    <script src="static/js/content-data.js"></script>
    <script src="static/js/chatbot.js"></script>
    <script src="static/js/content-manager.js"></script>
    <script src="static/js/app.js"></script>

    <!-- ì±—ë´‡ ì„¹ì…˜ ì—…ë°ì´íŠ¸ -->
    <div id="chatbot-section" class="tab-content hidden">
      <div class="p-4">
        <h2 class="text-2xl font-bold mb-4">ê²½ì œìš© AI ê²€ìƒ‰</h2>

        <!-- RAG ìƒíƒœ ë° ì´ˆê¸°í™” ë²„íŠ¼ -->
        <div class="rag-status-container">
          <div id="rag-status" class="text-gray-500">
            AI ê³ ê¸‰ ê¸°ëŠ¥: ë¹„í™œì„±í™”
          </div>
          <button
            id="init-rag-button"
            class="px-4 py-2 bg-orange-500 text-white rounded-md hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-opacity-50"
          >
            AI ê³ ê¸‰ ê¸°ëŠ¥ í™œì„±í™”
          </button>
        </div>

        <!-- ì¶”ì²œ ê²€ìƒ‰ì–´ ì˜ì—­ -->
        <div id="ai-suggested-searches" class="mt-4 mb-6">
          <h3 class="text-lg font-medium mb-3">ì¶”ì²œ ê²€ìƒ‰ì–´</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <div
              class="search-suggestion bg-white p-3 rounded-lg cursor-pointer border hover:border-orange-200 shadow-sm"
            >
              <p class="text-gray-800">ETFë€ ë¬´ì—‡ì¸ê°€ìš”?</p>
            </div>
            <div
              class="search-suggestion bg-white p-3 rounded-lg cursor-pointer border hover:border-orange-200 shadow-sm"
            >
              <p class="text-gray-800">ê¸ˆë¦¬ì¸ìƒì´ ì£¼ì‹ì‹œì¥ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì€?</p>
            </div>
            <div
              class="search-suggestion bg-white p-3 rounded-lg cursor-pointer border hover:border-orange-200 shadow-sm"
            >
              <p class="text-gray-800">ì¸í”Œë ˆì´ì…˜ í—¤ì§€ ë°©ë²•ì€ ë¬´ì—‡ì¸ê°€ìš”?</p>
            </div>
            <div
              class="search-suggestion bg-white p-3 rounded-lg cursor-pointer border hover:border-orange-200 shadow-sm"
            >
              <p class="text-gray-800">ìš”ì¦˜ ì£¼ëª©ë°›ëŠ” ê²½ì œ ì´ìŠˆëŠ” ë¬´ì—‡ì¸ê°€ìš”?</p>
            </div>
          </div>
        </div>

        <div class="chat-container">
          <div id="ai-chat-output" class="chat-output"></div>

          <!-- ê²€ìƒ‰ ê²°ê³¼ ì˜ì—­ -->
          <div id="ai-search-results" class="hidden">
            <!-- ë¡œë”© ìƒíƒœ -->
            <div
              id="ai-loading-state"
              class="bg-white rounded-lg shadow-sm p-4 mb-4 hidden"
            >
              <div class="flex items-center gap-3">
                <div
                  class="animate-spin rounded-full h-6 w-6 border-4 border-orange-500 border-t-transparent"
                ></div>
                <p class="text-gray-600">ë‹µë³€ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
              </div>
            </div>

            <!-- ë‹µë³€ ì˜ì—­ -->
            <div id="ai-answer-area" class="hidden">
              <div class="bg-white rounded-lg shadow-sm p-4 mb-4">
                <div class="flex items-start gap-3 mb-3">
                  <div class="p-2 bg-orange-100 rounded-lg">
                    <i class="fas fa-lightbulb text-orange-600"></i>
                  </div>
                  <h3 class="text-lg font-medium">AI ìš”ì•½</h3>
                </div>
                <div
                  id="ai-answer-content"
                  class="answer-container text-gray-800"
                ></div>
              </div>

              <!-- ì¶œì²˜ ì„¹ì…˜ -->
              <div
                id="ai-sources-area"
                class="bg-white rounded-lg shadow-sm p-4 mb-4"
              >
                <h3 class="text-lg font-medium mb-3">ì¶œì²˜</h3>
                <div id="ai-sources-list" class="space-y-3"></div>
              </div>
            </div>
          </div>

          <div class="chat-input-container mt-4">
            <input
              id="ai-chat-input"
              type="text"
              placeholder="ê²½ì œ ê´€ë ¨ ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..."
              class="flex-grow px-4 py-2 border rounded-l-md focus:outline-none w-full"
            />
            <button
              id="ai-send-button"
              class="px-4 py-2 bg-orange-500 text-white rounded-r-md hover:bg-orange-600 focus:outline-none"
            >
              ê²€ìƒ‰
            </button>
          </div>
        </div>

        <div class="mt-4 text-sm text-gray-500">
          <p>
            ğŸ’¡ <strong>ì‚¬ìš© íŒ:</strong> ê²½ì œ ìš©ì–´ë‚˜ íˆ¬ì ë°©ë²•ì— ëŒ€í•´
            ê²€ìƒ‰í•´ë³´ì„¸ìš”. AI ê³ ê¸‰ ê¸°ëŠ¥ì„ í™œì„±í™”í•˜ë©´ ë” ì •í™•í•œ ë‹µë³€ì„ ë°›ì„ ìˆ˜
            ìˆìŠµë‹ˆë‹¤.
          </p>
          <p class="mt-2">
            ğŸ“š <strong>ì˜ˆì‹œ ì§ˆë¬¸:</strong> "ETFê°€ ë¬´ì—‡ì¸ê°€ìš”?", "ì£¼ì‹ê³¼ ì±„ê¶Œì˜
            ì°¨ì´ëŠ”?", "ìš”ì¦˜ ë¹„íŠ¸ì½”ì¸ ìƒìŠ¹ ì´ìœ ëŠ”?"
          </p>
        </div>
      </div>
    </div>

    <!-- .env íŒŒì¼ ìƒì„± ì•ˆë‚´ ëª¨ë‹¬ -->
    <div id="env-modal" class="modal hidden">
      <div class="modal-content max-w-md">
        <span class="close">&times;</span>
        <h2 class="text-xl font-bold mb-4">API í‚¤ ì„¤ì • í•„ìš”</h2>
        <p class="mb-4">
          RAG ì±—ë´‡ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ OpenAI API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤. í”„ë¡œì íŠ¸ ë£¨íŠ¸
          ë””ë ‰í† ë¦¬ì— <code>.env</code> íŒŒì¼ì„ ìƒì„±í•˜ê³  ë‹¤ìŒ ë‚´ìš©ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”:
        </p>
        <div class="bg-gray-100 p-3 rounded mb-4 font-mono">
          OPENAI_API_KEY=your_api_key_here
        </div>
        <p class="text-sm text-gray-500">
          API í‚¤ëŠ”
          <a
            href="https://platform.openai.com/account/api-keys"
            target="_blank"
            class="text-orange-500 hover:underline"
            >OpenAI ì›¹ì‚¬ì´íŠ¸</a
          >ì—ì„œ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </p>
        <button
          id="close-env-modal"
          class="mt-4 px-4 py-2 bg-orange-500 text-white rounded-md hover:bg-orange-600 focus:outline-none"
        >
          í™•ì¸
        </button>
      </div>
    </div>

    <script>
      // ì „ì—­ ë³€ìˆ˜
      let currentCitations = [];

      // íƒ­ ì „í™˜
      document.querySelectorAll(".tab-button").forEach((button) => {
        button.addEventListener("click", () => {
          const targetTab = button.dataset.tab;

          // íƒ­ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
          document.querySelectorAll(".tab-button").forEach((btn) => {
            btn.classList.remove("text-blue-600", "font-medium");
            btn.classList.add("text-gray-600");
          });
          button.classList.remove("text-gray-600");
          button.classList.add("text-blue-600", "font-medium");

          // ì½˜í…ì¸  ì „í™˜
          document.querySelectorAll(".tab-content").forEach((content) => {
            content.classList.add("hidden");
          });
          document
            .getElementById(`${targetTab}-section`)
            .classList.remove("hidden");
        });
      });

      // ê²€ìƒ‰ ê¸°ëŠ¥
      async function performSearch(query) {
        if (!query.trim()) return;

        // UI ìƒíƒœ ë³€ê²½
        document.getElementById("suggested-searches").classList.add("hidden");
        document.getElementById("search-results").classList.remove("hidden");
        document.getElementById("loading-state").classList.remove("hidden");
        document.getElementById("answer-area").classList.add("hidden");

        try {
          const response = await fetch("/api/ai-search", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ query }),
          });

          const result = await response.json();

          if (result.status === "success") {
            displayResults(result);
          } else {
            displayError(result.message);
          }
        } catch (error) {
          displayError("ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // ê²°ê³¼ í‘œì‹œ
      function displayResults(result) {
        document.getElementById("loading-state").classList.add("hidden");
        document.getElementById("answer-area").classList.remove("hidden");

        // ë‹µë³€ í‘œì‹œ (ê°ì£¼ ë²ˆí˜¸ í¬í•¨)
        const answerWithCitations = addCitationLinks(result.answer);
        document.getElementById("answer-content").innerHTML =
          marked.parse(answerWithCitations);

        // ì¶œì²˜ í‘œì‹œ
        currentCitations = result.citations;
        displaySources(result.citations);
      }

      // ê°ì£¼ ë§í¬ ì¶”ê°€
      function addCitationLinks(text) {
        // [1], [2] í˜•ì‹ì˜ ê°ì£¼ë¥¼ í´ë¦­ ê°€ëŠ¥í•œ ë§í¬ë¡œ ë³€í™˜
        return text.replace(/\[(\d+)\]/g, (match, num) => {
          return `<a href="#citation-${num}" class="citation-link" onclick="scrollToCitation(${num}); return false;">[${num}]</a>`;
        });
      }

      // ì¶œì²˜ í‘œì‹œ
      function displaySources(citations) {
        const sourcesContainer = document.getElementById("sources-list");
        sourcesContainer.innerHTML = "";

        citations.forEach((citation) => {
          const sourceDiv = document.createElement("div");
          sourceDiv.className =
            "p-4 border rounded-lg hover:bg-gray-50 cursor-pointer transition-colors";
          sourceDiv.id = `citation-${citation.number}`;

          if (citation.type === "internal") {
            // ë‚´ë¶€ ë¬¸ì„œ ì¶œì²˜
            sourceDiv.innerHTML = `
              <div class="flex items-start gap-3">
                <div class="text-gray-400">${citation.number}</div>
                <div class="flex-1">
                  <h4 class="font-medium text-gray-800">${citation.title}</h4>
                  <p class="text-sm text-gray-600 mt-1">${citation.content}</p>
                  <p class="text-xs text-blue-600 mt-2">
                    ê²½ì œìš© ${
                      citation.source_type === "economy_terms"
                        ? "ê²½ì œ ìš©ì–´"
                        : "ìµœì‹  ì½˜í…ì¸ "
                    }
                  </p>
                </div>
              </div>
            `;

            // í´ë¦­ ì‹œ ë‚´ë¶€ ë¬¸ì„œë¡œ ì´ë™
            sourceDiv.addEventListener("click", () => {
              openInternalDocument(citation.file_name, citation.source_type);
            });
          } else {
            // ì›¹ ê²€ìƒ‰ ì¶œì²˜
            sourceDiv.innerHTML = `
              <div class="flex items-start gap-3">
                <div class="text-gray-400">${citation.number}</div>
                <div class="flex-1">
                  <h4 class="font-medium text-gray-800">${citation.title}</h4>
                  <p class="text-sm text-gray-600 mt-1">${citation.content}</p>
                  <p class="text-xs text-green-600 mt-2">ì›¹ ê²€ìƒ‰ ê²°ê³¼</p>
                </div>
              </div>
            `;
          }

          sourcesContainer.appendChild(sourceDiv);
        });
      }

      // ë‚´ë¶€ ë¬¸ì„œ ì—´ê¸°
      function openInternalDocument(fileName, sourceType) {
        // ê²½ì œìš© íƒ­ ì „í™˜ ë° ëª¨ë‹¬ ì—´ê¸°
        if (window.parent && window.parent.ContentManager) {
          // í•´ë‹¹ íƒ­ìœ¼ë¡œ ì „í™˜
          const tabId =
            sourceType === "economy_terms" ? "tab-terms" : "tab-contents";
          window.parent.document.getElementById(tabId).click();

          // ëª¨ë‹¬ ì—´ê¸°
          window.parent.ContentManager.openContentModal(fileName, sourceType);
        } else {
          // ìƒˆ ì°½ì—ì„œ ì—´ê¸°
          window.open(`/view/${sourceType}/${fileName}`, "_blank");
        }
      }

      // ê°ì£¼ë¡œ ìŠ¤í¬ë¡¤
      function scrollToCitation(num) {
        const element = document.getElementById(`citation-${num}`);
        if (element) {
          element.scrollIntoView({ behavior: "smooth", block: "center" });
          element.classList.add("bg-blue-50");
          setTimeout(() => {
            element.classList.remove("bg-blue-50");
          }, 2000);
        }
      }

      // ì˜¤ë¥˜ í‘œì‹œ
      function displayError(message) {
        document.getElementById("loading-state").classList.add("hidden");
        document.getElementById("answer-area").classList.remove("hidden");
        document.getElementById("answer-content").innerHTML = `
          <div class="text-red-600">
            <i class="fas fa-exclamation-circle"></i> ${message}
          </div>
        `;
        document.getElementById("sources-area").classList.add("hidden");
      }

      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
      document.getElementById("send-button").addEventListener("click", () => {
        const query = document.getElementById("chat-input").value;
        performSearch(query);
      });

      document.getElementById("chat-input").addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          const query = e.target.value;
          performSearch(query);
        }
      });

      // AI ê²€ìƒ‰ íƒ­ì˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      document
        .getElementById("ai-send-button")
        .addEventListener("click", () => {
          const query = document.getElementById("ai-chat-input").value;
          performAISearch(query);
        });

      document
        .getElementById("ai-chat-input")
        .addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            const query = e.target.value;
            performAISearch(query);
          }
        });

      // AI ê²€ìƒ‰ ê¸°ëŠ¥
      async function performAISearch(query) {
        if (!query.trim()) return;

        // UI ìƒíƒœ ë³€ê²½
        document
          .getElementById("ai-suggested-searches")
          .classList.add("hidden");
        document.getElementById("ai-search-results").classList.remove("hidden");
        document.getElementById("ai-loading-state").classList.remove("hidden");
        document.getElementById("ai-answer-area").classList.add("hidden");

        try {
          const response = await fetch("/api/ai-search", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ query }),
          });

          const result = await response.json();

          if (result.status === "success") {
            displayAIResults(result);
          } else {
            displayAIError(result.message);
          }
        } catch (error) {
          displayAIError("ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // AI ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ
      function displayAIResults(result) {
        document.getElementById("ai-loading-state").classList.add("hidden");
        document.getElementById("ai-answer-area").classList.remove("hidden");

        // ë‹µë³€ í‘œì‹œ (ê°ì£¼ ë²ˆí˜¸ í¬í•¨)
        const answerWithCitations = addCitationLinks(result.answer);
        document.getElementById("ai-answer-content").innerHTML =
          marked.parse(answerWithCitations);

        // ì¶œì²˜ í‘œì‹œ
        displayAISources(result.citations);
      }

      // AI ê²€ìƒ‰ ì˜¤ë¥˜ í‘œì‹œ
      function displayAIError(message) {
        document.getElementById("ai-loading-state").classList.add("hidden");
        document.getElementById("ai-answer-area").classList.remove("hidden");
        document.getElementById("ai-answer-content").innerHTML = `
          <div class="text-red-600">
            <i class="fas fa-exclamation-circle"></i> ${message}
          </div>
        `;
        document.getElementById("ai-sources-area").classList.add("hidden");
      }

      // AI ê²€ìƒ‰ ì¶œì²˜ í‘œì‹œ
      function displayAISources(citations) {
        const sourcesContainer = document.getElementById("ai-sources-list");
        sourcesContainer.innerHTML = "";

        citations.forEach((citation) => {
          const sourceDiv = document.createElement("div");
          sourceDiv.className =
            "p-3 border rounded-lg hover:bg-gray-50 cursor-pointer transition-colors";
          sourceDiv.id = `ai-citation-${citation.number}`;

          if (citation.type === "internal") {
            // ë‚´ë¶€ ë¬¸ì„œ ì¶œì²˜
            sourceDiv.innerHTML = `
              <div class="flex items-start gap-3">
                <div class="text-gray-400">${citation.number}</div>
                <div class="flex-1">
                  <h4 class="font-medium text-gray-800">${citation.title}</h4>
                  <p class="text-sm text-gray-600 mt-1">${citation.content}</p>
                  <p class="text-xs text-blue-600 mt-2">
                    ê²½ì œìš© ${
                      citation.source_type === "economy_terms"
                        ? "ê²½ì œ ìš©ì–´"
                        : "ìµœì‹  ì½˜í…ì¸ "
                    }
                  </p>
                </div>
              </div>
            `;

            // í´ë¦­ ì‹œ ë‚´ë¶€ ë¬¸ì„œë¡œ ì´ë™
            sourceDiv.addEventListener("click", () => {
              openInternalDocument(citation.file_name, citation.source_type);
            });
          } else {
            // ì›¹ ê²€ìƒ‰ ì¶œì²˜
            sourceDiv.innerHTML = `
              <div class="flex items-start gap-3">
                <div class="text-gray-400">${citation.number}</div>
                <div class="flex-1">
                  <h4 class="font-medium text-gray-800">${citation.title}</h4>
                  <p class="text-sm text-gray-600 mt-1">${citation.content}</p>
                  <p class="text-xs text-green-600 mt-2">ì›¹ ê²€ìƒ‰ ê²°ê³¼</p>
                </div>
              </div>
            `;
          }

          sourcesContainer.appendChild(sourceDiv);
        });
      }

      // AI ì¶”ì²œ ê²€ìƒ‰ì–´ í´ë¦­
      document.querySelectorAll(".search-suggestion").forEach((suggestion) => {
        suggestion.addEventListener("click", () => {
          const query = suggestion.querySelector("p").textContent;

          // í˜„ì¬ í™œì„±í™”ëœ íƒ­ì— ë”°ë¼ ì…ë ¥ í•„ë“œ ì„¤ì •
          const isMainTab = !document
            .getElementById("chatbot-section")
            .classList.contains("hidden");
          const inputField = isMainTab
            ? document.getElementById("chat-input")
            : document.getElementById("ai-chat-input");
          inputField.value = query;

          if (isMainTab) {
            performSearch(query);
          } else {
            performAISearch(query);
          }
        });
      });
    </script>
  </body>
</html>
