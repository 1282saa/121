<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>AI ê²€ìƒ‰ í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="p-8">
    <div class="max-w-2xl mx-auto">
      <h1 class="text-2xl font-bold mb-4">AI ê²€ìƒ‰ í…ŒìŠ¤íŠ¸</h1>

      <div class="mb-4">
        <button
          id="check-status"
          class="px-4 py-2 bg-blue-500 text-white rounded"
        >
          ìƒíƒœ í™•ì¸
        </button>
        <button
          id="init-search"
          class="px-4 py-2 bg-green-500 text-white rounded"
        >
          ì´ˆê¸°í™”
        </button>
      </div>

      <div id="status" class="mb-4 p-4 bg-gray-100 rounded"></div>

      <div class="mb-4">
        <input
          id="query"
          type="text"
          value="ETFë€ ë¬´ì—‡ì¸ê°€ìš”?"
          class="w-full p-2 border rounded"
        />
        <button
          id="search"
          class="px-4 py-2 bg-orange-500 text-white rounded mt-2"
        >
          ê²€ìƒ‰
        </button>
      </div>

      <div id="result" class="p-4 bg-gray-50 rounded"></div>
    </div>

    <script>
      // ìƒíƒœ í™•ì¸
      document
        .getElementById("check-status")
        .addEventListener("click", async () => {
          const response = await fetch("/api/ai-search/status");
          const data = await response.json();
          document.getElementById("status").innerHTML = `
                <div>ì¤€ë¹„ ìƒíƒœ: ${
                  data.ready ? "âœ… ì¤€ë¹„ë¨" : "âŒ ì¤€ë¹„ë˜ì§€ ì•ŠìŒ"
                }</div>
                <div>ì´ˆê¸°í™” ì¤‘: ${
                  data.initializing ? "ğŸ”„ ì´ˆê¸°í™” ì¤‘" : "ëŒ€ê¸° ì¤‘"
                }</div>
            `;
        });

      // ì´ˆê¸°í™”
      document
        .getElementById("init-search")
        .addEventListener("click", async () => {
          const response = await fetch("/api/ai-search/initialize", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
          });
          const data = await response.json();
          alert(data.message);
        });

      // ê²€ìƒ‰
      document.getElementById("search").addEventListener("click", async () => {
        const query = document.getElementById("query").value;
        const resultDiv = document.getElementById("result");

        resultDiv.innerHTML = "ê²€ìƒ‰ ì¤‘...";

        try {
          const response = await fetch("/api/ai-search", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ query }),
          });

          const data = await response.json();

          if (data.status === "success") {
            let html = `<h3 class="font-bold mb-2">ë‹µë³€:</h3>`;
            html += `<div class="mb-4">${data.answer}</div>`;

            html += `<h3 class="font-bold mb-2">ì¶œì²˜:</h3>`;
            data.citations.forEach((cite) => {
              html += `<div class="mb-2 p-2 border rounded">`;
              html += `<div>[${cite.number}] ${cite.title}</div>`;
              html += `<div class="text-sm text-gray-600">${cite.content}</div>`;
              html += `<div class="text-xs text-blue-600">${cite.type}</div>`;
              html += `</div>`;
            });

            resultDiv.innerHTML = html;
          } else {
            resultDiv.innerHTML = `<div class="text-red-600">ì˜¤ë¥˜: ${data.message}</div>`;
          }
        } catch (error) {
          resultDiv.innerHTML = `<div class="text-red-600">ì˜¤ë¥˜: ${error.message}</div>`;
        }
      });

      // í˜ì´ì§€ ë¡œë“œì‹œ ìƒíƒœ í™•ì¸
      document.getElementById("check-status").click();
    </script>
  </body>
</html>
